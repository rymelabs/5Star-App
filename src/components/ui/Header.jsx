import React, { useState, memo } from 'react';
import { useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import { Search, Bell } from 'lucide-react';
import { useAuth } from '../../context/AuthContext';
import { useNotification } from '../../context/NotificationContext';
import { isFestiveSeason } from '../../utils/dateUtils';
import SearchModal from '../ui/SearchModal';
import ProfileModal from '../ProfileModal';
import ChristmasLogo from '../ChristmasLogo';

const Header = memo(() => {
  const { user } = useAuth();
  const { unreadCount } = useNotification();
  const navigate = useNavigate();
  const [isSearchOpen, setIsSearchOpen] = useState(false);
  const [isProfileOpen, setIsProfileOpen] = useState(false);

  const handleNotificationClick = () => {
    navigate('/notifications');
  };

  return (
    <>
      <div className="flex items-center justify-between px-4 py-3">
        {isFestiveSeason() ? (
          <ChristmasLogo
            initial={{ opacity: 0, x: -20, filter: "blur(10px)" }}
            animate={{ opacity: 1, x: 0, filter: "blur(0px)" }}
            transition={{ 
              duration: 0.8, 
              ease: [0.16, 1, 0.3, 1],
              delay: 0.2 
            }}
            className="h-8 w-auto drop-shadow-[0_0_10px_rgba(109,40,217,0.5)]"
          />
        ) : (
        <motion.svg 
          initial={{ opacity: 0, x: -20, filter: "blur(10px)" }}
          animate={{ opacity: 1, x: 0, filter: "blur(0px)" }}
          transition={{ 
            duration: 0.8, 
            ease: [0.16, 1, 0.3, 1],
            delay: 0.2 
          }}
          viewBox="0 0 104 31" 
          className="h-8 w-auto drop-shadow-[0_0_10px_rgba(109,40,217,0.5)]" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
        >
          {/* The Ball / 'O' - Animated */}
          <motion.g
            initial={{ scale: 0, rotate: -180 }}
            animate={{ scale: 1, rotate: 0 }}
            transition={{ 
              type: "spring",
              stiffness: 260,
              damping: 20,
              delay: 0.5 
            }}
            style={{ originX: "66px", originY: "16px" }}
          >
            <path d="M69.7542 14.4118C67.6198 11.8714 64.3566 11.1005 61.6736 13.3548C60.5238 14.3209 58.9294 16.3143 58.6843 19.1356C59.6732 17.9779 61.0226 18.8057 61.0226 18.8057C58.6231 19.8409 57.2282 23.6283 58.7771 26.2501C60.0804 24.6883 61.5214 23.2905 64.6647 23.9188C66.2364 24.233 68.0449 23.6943 69.4025 22.5537C72.0855 20.2994 71.8887 16.9522 69.7542 14.4118ZM68.9876 15.0559C70.0549 16.3261 70.1533 17.9997 68.8118 19.1268C68.2368 19.6099 67.1176 20.2233 65.7069 20.1008C66.3624 19.7136 66.1821 18.7208 66.1821 18.7208C65.4654 19.8133 63.3687 20.4307 62.211 19.4419C63.0928 18.935 63.9051 18.3454 63.8666 16.7431C63.8474 15.9419 64.2682 15.098 64.9473 14.5274C66.2888 13.4002 67.9204 13.7857 68.9876 15.0559Z" fill="#1862AC"/>
            <path d="M72.242 16.8144C72.242 19.8876 69.7509 22.3788 66.6777 22.3788C63.6045 22.3788 61.1133 19.8876 61.1133 16.8144C61.1133 13.7412 63.6045 11.25 66.6777 11.25C69.7509 11.25 72.242 13.7412 72.242 16.8144Z" fill="white"/>
            <path d="M70.4908 12.7619C70.0373 15.3799 67.7554 17.3709 65.0083 17.3709C63.5905 17.3727 62.2258 16.8318 61.1944 15.859M72.1362 15.7294C70.9582 18.3379 68.3341 20.153 65.2865 20.153C64.0176 20.155 62.7691 19.8341 61.6585 19.2205M62.0335 13.7473C62.5549 14.1598 63.1731 14.4321 63.8293 14.5382C64.4856 14.6443 65.1581 14.5807 65.7828 14.3535C66.4076 14.1263 66.9638 13.743 67.3986 13.2401C67.8334 12.7372 68.1322 12.1314 68.2668 11.4804" fill="white"/>
            <path d="M70.7101 12.7999C70.7311 12.6787 70.6499 12.5635 70.5288 12.5426C70.4077 12.5216 70.2925 12.6028 70.2715 12.7239L70.4908 12.7619L70.7101 12.7999ZM65.0083 17.3709L65.0083 17.1483L65.008 17.1483L65.0083 17.3709ZM61.3471 15.6971C61.2577 15.6127 61.1169 15.6169 61.0325 15.7063C60.9482 15.7957 60.9523 15.9366 61.0417 16.0209L61.1944 15.859L61.3471 15.6971ZM72.3391 15.821C72.3897 15.7089 72.3399 15.5771 72.2278 15.5265C72.1158 15.4759 71.984 15.5257 71.9334 15.6378L72.1362 15.7294L72.3391 15.821ZM65.2865 20.153V19.9305L65.2861 19.9305L65.2865 20.153ZM61.7661 19.0256C61.6585 18.9662 61.5231 19.0052 61.4637 19.1128C61.4042 19.2204 61.4433 19.3558 61.5509 19.4153L61.6585 19.2205L61.7661 19.0256ZM62.1716 13.5728C62.0753 13.4965 61.9353 13.5128 61.859 13.6092C61.7827 13.7056 61.799 13.8456 61.8954 13.9219L62.0335 13.7473L62.1716 13.5728ZM68.4847 11.5254C68.5096 11.4051 68.4322 11.2873 68.3118 11.2624C68.1914 11.2376 68.0737 11.315 68.0488 11.4354L68.2668 11.4804L68.4847 11.5254ZM72.242 16.8144H72.0195C72.0195 19.7647 69.6279 22.1562 66.6777 22.1562V22.3788V22.6013C69.8738 22.6013 72.4646 20.0105 72.4646 16.8144H72.242ZM66.6777 22.3788V22.1562C63.7274 22.1562 61.3359 19.7647 61.3359 16.8144H61.1133H60.8907C60.8907 20.0105 63.4815 22.6013 66.6777 22.6013V22.3788ZM61.1133 16.8144H61.3359C61.3359 13.8641 63.7274 11.4726 66.6777 11.4726V11.25V11.0274C63.4815 11.0274 60.8907 13.6182 60.8907 16.8144H61.1133ZM66.6777 11.25V11.4726C69.6279 11.4726 72.0195 13.8641 72.0195 16.8144H72.242H72.4646C72.4646 13.6182 69.8738 11.0274 66.6777 11.0274V11.25ZM70.4908 12.7619L70.2715 12.7239C69.8362 15.2371 67.6452 17.1483 65.0083 17.1483V17.3709V17.5934C67.8655 17.5934 70.2385 15.5227 70.7101 12.7999L70.4908 12.7619ZM65.0083 17.3709L65.008 17.1483C63.6471 17.1501 62.3372 16.6308 61.3471 15.6971L61.1944 15.859L61.0417 16.0209C62.1145 17.0327 63.5339 17.5954 65.0086 17.5934L65.0083 17.3709ZM72.1362 15.7294L71.9334 15.6378C70.7901 18.1695 68.2434 19.9305 65.2865 19.9305V20.153V20.3756C68.4247 20.3756 71.1264 18.5063 72.3391 15.821L72.1362 15.7294ZM65.2865 20.153L65.2861 19.9305C64.055 19.9324 62.8437 19.621 61.7661 19.0256L61.6585 19.2205L61.5509 19.4153C62.6945 20.0471 63.9802 20.3776 65.2868 20.3756L65.2865 20.153ZM62.0335 13.7473L61.8954 13.9219C62.4465 14.3579 63.1 14.6458 63.7938 14.7579L63.8293 14.5382L63.8648 14.3185C63.2461 14.2184 62.6632 13.9617 62.1716 13.5728L62.0335 13.7473ZM63.8293 14.5382L63.7938 14.7579C64.4875 14.8701 65.1985 14.8029 65.8589 14.5627L65.7828 14.3535L65.7068 14.1443C65.1177 14.3586 64.4836 14.4185 63.8648 14.3185L63.8293 14.5382ZM65.7828 14.3535L65.8589 14.5627C66.5193 14.3225 67.1073 13.9173 67.567 13.3857L67.3986 13.2401L67.2302 13.0945C66.8203 13.5687 66.2958 13.9301 65.7068 14.1443L65.7828 14.3535ZM67.3986 13.2401L67.567 13.3857C68.0266 12.8541 68.3425 12.2137 68.4847 11.5254L68.2668 11.4804L68.0488 11.4354C67.9219 12.0492 67.6401 12.6204 67.2302 13.0945L67.3986 13.2401Z" fill="#1862AC"/>
          </motion.g>
          
          {/* The Text "Fivescores" */}
          <motion.g
            initial={{ opacity: 0, x: -10 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.5, delay: 0.3 }}
          >
            <path d="M7.05375 14.42H5.15625V23H1.62938V14.42H0.350625V11.4912H1.62938V11.1612C1.62938 9.745 2.035 8.6725 2.84625 7.94375C3.6575 7.20125 4.84688 6.83 6.41438 6.83C6.67563 6.83 6.86813 6.83687 6.99188 6.85062V9.84125C6.31813 9.8 5.84375 9.89625 5.56875 10.13C5.29375 10.3637 5.15625 10.7831 5.15625 11.3881V11.4912H7.05375V14.42ZM9.96913 10.295C9.35038 10.295 8.84163 10.1162 8.44288 9.75875C8.05788 9.3875 7.86538 8.93375 7.86538 8.3975C7.86538 7.8475 8.05788 7.39375 8.44288 7.03625C8.84163 6.665 9.35038 6.47937 9.96913 6.47937C10.5741 6.47937 11.0691 6.665 11.4541 7.03625C11.8529 7.39375 12.0523 7.8475 12.0523 8.3975C12.0523 8.93375 11.8529 9.3875 11.4541 9.75875C11.0691 10.1162 10.5741 10.295 9.96913 10.295ZM11.7223 11.4912V23H8.19538V11.4912H11.7223ZM18.9394 19.7L21.435 11.4912H25.1888L21.105 23H16.7531L12.6694 11.4912H16.4438L18.9394 19.7ZM37.0064 17.06C37.0064 17.39 36.9858 17.7337 36.9445 18.0912H28.9627C29.0177 18.8062 29.2445 19.3562 29.6433 19.7412C30.0558 20.1125 30.5577 20.2981 31.1489 20.2981C32.0289 20.2981 32.6408 19.9269 32.9845 19.1844H36.7383C36.5458 19.9406 36.1952 20.6212 35.6864 21.2262C35.1914 21.8312 34.5658 22.3056 33.8095 22.6494C33.0533 22.9931 32.2077 23.165 31.2727 23.165C30.1452 23.165 29.1414 22.9244 28.2614 22.4431C27.3814 21.9619 26.6939 21.2744 26.1989 20.3806C25.7039 19.4869 25.4564 18.4419 25.4564 17.2456C25.4564 16.0494 25.697 15.0044 26.1783 14.1106C26.6733 13.2169 27.3608 12.5294 28.2408 12.0481C29.1208 11.5669 30.1314 11.3262 31.2727 11.3262C32.3864 11.3262 33.3764 11.56 34.2427 12.0275C35.1089 12.495 35.7827 13.1619 36.2639 14.0281C36.7589 14.8944 37.0064 15.905 37.0064 17.06ZM33.397 16.1319C33.397 15.5269 33.1908 15.0456 32.7783 14.6881C32.3658 14.3306 31.8502 14.1519 31.2314 14.1519C30.6402 14.1519 30.1383 14.3237 29.7258 14.6675C29.327 15.0112 29.0795 15.4994 28.9833 16.1319H33.397ZM43.0333 23.165C42.0295 23.165 41.1358 22.9931 40.352 22.6494C39.5683 22.3056 38.9495 21.8381 38.4958 21.2469C38.042 20.6419 37.7876 19.9681 37.7326 19.2256H41.2183C41.2595 19.6244 41.4451 19.9475 41.7751 20.195C42.1051 20.4425 42.5108 20.5662 42.992 20.5662C43.432 20.5662 43.7689 20.4837 44.0026 20.3187C44.2501 20.14 44.3739 19.9131 44.3739 19.6381C44.3739 19.3081 44.202 19.0675 43.8583 18.9162C43.5145 18.7512 42.9576 18.5725 42.1876 18.38C41.3626 18.1875 40.6751 17.9881 40.1251 17.7819C39.5751 17.5619 39.1008 17.225 38.702 16.7712C38.3033 16.3037 38.1039 15.6781 38.1039 14.8944C38.1039 14.2344 38.2826 13.6362 38.6401 13.1C39.0114 12.55 39.5476 12.1169 40.2489 11.8006C40.9639 11.4844 41.8095 11.3262 42.7858 11.3262C44.2295 11.3262 45.3639 11.6837 46.1889 12.3988C47.0276 13.1137 47.5089 14.0625 47.6326 15.245H44.3739C44.3189 14.8462 44.1401 14.53 43.8376 14.2962C43.5489 14.0625 43.1639 13.9456 42.6826 13.9456C42.2701 13.9456 41.9539 14.0281 41.7339 14.1931C41.5139 14.3444 41.4039 14.5575 41.4039 14.8325C41.4039 15.1625 41.5758 15.41 41.9195 15.575C42.277 15.74 42.827 15.905 43.5695 16.07C44.422 16.29 45.1164 16.51 45.6526 16.73C46.1889 16.9362 46.6564 17.28 47.0551 17.7612C47.4676 18.2287 47.6808 18.8612 47.6945 19.6587C47.6945 20.3325 47.502 20.9375 47.117 21.4737C46.7458 21.9962 46.2026 22.4087 45.4876 22.7112C44.7864 23.0138 43.9683 23.165 43.0333 23.165ZM48.6354 17.2456C48.6354 16.0494 48.876 15.0044 49.3572 14.1106C49.8522 13.2169 50.5329 12.5294 51.3991 12.0481C52.2791 11.5669 53.2829 11.3262 54.4104 11.3262C55.8541 11.3262 57.0572 11.7044 58.0197 12.4606C58.996 13.2169 59.6354 14.2825 59.9379 15.6575H56.1841C55.8679 14.7775 55.256 14.3375 54.3485 14.3375C53.7022 14.3375 53.1866 14.5919 52.8016 15.1006C52.4166 15.5956 52.2241 16.3106 52.2241 17.2456C52.2241 18.1806 52.4166 18.9025 52.8016 19.4112C53.1866 19.9062 53.7022 20.1537 54.3485 20.1537C55.256 20.1537 55.8679 19.7137 56.1841 18.8337H59.9379C59.6354 20.1812 58.996 21.24 58.0197 22.01C57.0435 22.78 55.8404 23.165 54.4104 23.165C53.2829 23.165 52.2791 22.9244 51.3991 22.4431C50.5329 21.9619 49.8522 21.2744 49.3572 20.3806C48.876 19.4869 48.6354 18.4419 48.6354 17.2456ZM76.401 13.4094C76.8135 12.7769 77.3291 12.2819 77.9478 11.9244C78.5666 11.5531 79.2541 11.3675 80.0103 11.3675V15.1006H79.041C78.161 15.1006 77.501 15.2931 77.061 15.6781C76.621 16.0494 76.401 16.7094 76.401 17.6581V23H72.8741V11.4912H76.401V13.4094ZM92.0292 17.06C92.0292 17.39 92.0086 17.7337 91.9674 18.0912H83.9855C84.0405 18.8062 84.2674 19.3562 84.6661 19.7412C85.0786 20.1125 85.5805 20.2981 86.1717 20.2981C87.0517 20.2981 87.6636 19.9269 88.0074 19.1844H91.7611C91.5686 19.9406 91.218 20.6212 90.7092 21.2262C90.2142 21.8312 89.5886 22.3056 88.8324 22.6494C88.0761 22.9931 87.2305 23.165 86.2955 23.165C85.168 23.165 84.1642 22.9244 83.2842 22.4431C82.4042 21.9619 81.7167 21.2744 81.2217 20.3806C80.7267 19.4869 80.4792 18.4419 80.4792 17.2456C80.4792 16.0494 80.7199 15.0044 81.2011 14.1106C81.6961 13.2169 82.3836 12.5294 83.2636 12.0481C84.1436 11.5669 85.1542 11.3262 86.2955 11.3262C87.4092 11.3262 88.3992 11.56 89.2655 12.0275C90.1317 12.495 90.8055 13.1619 91.2867 14.0281C91.7817 14.8944 92.0292 15.905 92.0292 17.06ZM88.4199 16.1319C88.4199 15.5269 88.2136 15.0456 87.8011 14.6881C87.3886 14.3306 86.873 14.1519 86.2542 14.1519C85.663 14.1519 85.1611 14.3237 84.7486 14.6675C84.3499 15.0112 84.1024 15.4994 84.0061 16.1319H88.4199ZM98.0561 23.165C97.0523 23.165 96.1586 22.9931 95.3748 22.6494C94.5911 22.3056 93.9723 21.8381 93.5186 21.2469C93.0648 20.6419 92.8105 19.9681 92.7555 19.2256H96.2411C96.2823 19.6244 96.468 19.9475 96.798 20.195C97.128 20.4425 97.5336 20.5662 98.0148 20.5662C98.4548 20.5662 98.7917 20.4837 99.0255 20.3187C99.273 20.14 99.3967 19.9131 99.3967 19.6381C99.3967 19.3081 99.2248 19.0675 98.8811 18.9162C98.5373 18.7512 97.9805 18.5725 97.2105 18.38C96.3855 18.1875 95.698 17.9881 95.148 17.7819C94.598 17.5619 94.1236 17.225 93.7248 16.7712C93.3261 16.3037 93.1267 15.6781 93.1267 14.8944C93.1267 14.2344 93.3055 13.6362 93.663 13.1C94.0342 12.55 94.5705 12.1169 95.2717 11.8006C95.9867 11.4844 96.8323 11.3262 97.8086 11.3262C99.2523 11.3262 100.387 11.6837 101.212 12.3988C102.05 13.1137 102.532 14.0625 102.655 15.245H99.3967C99.3417 14.8462 99.163 14.53 98.8605 14.2962C98.5717 14.0625 98.1867 13.9456 97.7055 13.9456C97.293 13.9456 96.9767 14.0281 96.7567 14.1931C96.5367 14.3444 96.4267 14.5575 96.4267 14.8325C96.4267 15.1625 96.5986 15.41 96.9423 15.575C97.2998 15.74 97.8498 15.905 98.5923 16.07C99.4448 16.29 100.139 16.51 100.675 16.73C101.212 16.9362 101.679 17.28 102.078 17.7612C102.49 18.2287 102.704 18.8612 102.717 19.6587C102.717 20.3325 102.525 20.9375 102.14 21.4737C101.769 21.9962 101.225 22.4087 100.51 22.7112C99.8092 23.0138 98.9911 23.165 98.0561 23.165Z" fill="white"/>
          </motion.g>
        </motion.svg>
        )}
        
        <div className="flex items-center space-x-2">
          <button
            onClick={() => setIsSearchOpen(true)}
            className="p-2 text-gray-400 hover:text-brand-purple hover:bg-white/5 rounded-full transition-all"
          >
            <Search className="w-5 h-5" />
          </button>
          
          <button
            onClick={handleNotificationClick}
            className="relative p-2 text-gray-400 hover:text-brand-purple hover:bg-white/5 rounded-full transition-all"
          >
            <Bell className="w-5 h-5" />
            {unreadCount > 0 && (
              <span className="absolute top-1 right-1 flex items-center justify-center w-4 h-4 text-[10px] font-bold text-white bg-brand-red rounded-full shadow-sm">
                {unreadCount > 9 ? '9+' : unreadCount}
              </span>
            )}
          </button>
          
          <button
            onClick={() => setIsProfileOpen(true)}
            className="ml-1 w-8 h-8 rounded-full overflow-hidden border border-white/10 hover:border-brand-purple transition-colors"
          >
            {user?.photoURL ? (
              <img src={user.photoURL} alt="Profile" className="w-full h-full object-cover" />
            ) : (
              <div className="w-full h-full bg-elevated flex items-center justify-center text-xs font-bold text-brand-purple">
                {user?.email?.[0]?.toUpperCase() || 'G'}
              </div>
            )}
          </button>
        </div>
      </div>

      <SearchModal isOpen={isSearchOpen} onClose={() => setIsSearchOpen(false)} />
      <ProfileModal isOpen={isProfileOpen} onClose={() => setIsProfileOpen(false)} />
    </>
  );
});

Header.displayName = 'Header';

export default Header;
